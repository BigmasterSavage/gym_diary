<!-- templates/createtraining.html -->
{% extends "base.html" %}
{% block title %}Создать тренировку{% endblock %}
{% block content %}
<h2>Создать новую тренировку</h2>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<form method="post">
    <label>Дата тренировки:</label>
    <input type="date" name="date" required value="{{ request.form.date or '' }}">

    <label>Примечание к тренировке:</label>
    <textarea name="note">{{ request.form.note or '' }}</textarea>

    <h3>Подходы</h3>
    <div id="sets-container">
        <div class="set-row">
            <select name="exercise_id" required>
                <option value="">-- Выберите упражнение --</option>
                {% for ex in exercises %}
                    <option value="{{ ex.id }}">{{ ex.name }}</option>
                {% endfor %}
            </select>
            <input type="number" step="0.1" name="weight_kg" placeholder="Вес, кг">
            <input type="number" name="reps" placeholder="Повторы">
            <input type="text" name="set_note" placeholder="Примечание">
            <button type="button" onclick="removeSet(this)" class="btn">Удалить</button>
        </div>
    </div>
    <button type="button" onclick="addSet()" class="btn">+ Добавить подход</button><br><br>
    <button type="submit" class="btn">Сохранить тренировку</button>
</form>

<script>
    function addSet() {
        const container = document.getElementById('sets-container');
        const row = document.createElement('div');
        row.className = 'set-row';
        row.innerHTML = `
            <select name="exercise_id" required>
                <option value="">-- Выберите упражнение --</option>
                {% for ex in exercises %}
                    <option value="{{ ex.id }}">{{ ex.name }}</option>
                {% endfor %}
            </select>
            <input type="number" step="0.1" name="weight_kg" placeholder="Вес, кг">
            <input type="number" name="reps" placeholder="Повторы">
            <input type="text" name="set_note" placeholder="Примечание">
            <button type="button" onclick="removeSet(this)" class="btn">Удалить</button>
        `;
        container.appendChild(row);
    }

    function removeSet(button) {
        const row = button.parentNode;
        row.remove();
    }
</script>
{% endblock %}