<!-- templates/changetraining.html -->
{% extends "base.html" %}
{% block title %}Редактировать тренировку{% endblock %}
{% block content %}
<h2>Редактировать тренировку</h2>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<form method="get" action="/changetraining">
    <label>Выберите тренировку:</label>
    <select name="workout_id" onchange="this.form.submit()">
        <option value="">-- Выберите --</option>
        {% for w in workouts %}
            <option value="{{ w.id }}" {% if selected_workout and selected_workout.id == w.id %}selected{% endif %}>
                {{ w.date }} — {{ w.note or 'Без примечания' }}
            </option>
        {% endfor %}
    </select>
</form>

{% if selected_workout %}
    <form method="post">
        <input type="hidden" name="workout_id" value="{{ selected_workout.id }}">

        <table border="1" cellpadding="10" style="width:100%; margin-top:20px;">
            <thead>
                <tr>
                    <th>Упражнение</th>
                    <th>Вес, кг</th>
                    <th>Повторы</th>
                    <th>Примечание</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                {% for s in sets %}
                    <tr>
                        <td>
                            <input type="hidden" name="set_id" value="{{ s.set_id }}">
                            <select name="exercise_id" required>
                                <option value="">-- Не выбрано --</option>
                                {% for ex in exercises %}
                                    <option value="{{ ex.id }}" {% if ex.id == s.exercise_id %}selected{% endif %}>
                                        {{ ex.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                        <td><input type="number" step="0.1" name="weight_kg" value="{{ s.weight_kg or '' }}"></td>
                        <td><input type="number" name="reps" value="{{ s.reps }}" required></td>
                        <td><input type="text" name="set_note" value="{{ s.note or '' }}"></td>
                        <td>
                            <form method="post" style="display:inline;">
                                <input type="hidden" name="action" value="delete_set">
                                <input type="hidden" name="set_id" value="{{ s.set_id }}">
                                <input type="hidden" name="workout_id" value="{{ selected_workout.id }}">
                                <button type="submit" class="btn" onclick="return confirm('Вы уверены?')">Удалить</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <button type="submit" class="btn">Сохранить изменения</button>

        <form method="post" style="margin-top: 10px;">
            <input type="hidden" name="action" value="add_set">
            <input type="hidden" name="workout_id" value="{{ selected_workout.id }}">
            <button type="submit" class="btn">+ Добавить подход</button>
        </form>

        <form method="post" style="margin-top: 20px;">
            <input type="hidden" name="action" value="delete_workout">
            <input type="hidden" name="workout_id" value="{{ selected_workout.id }}">
            <button type="submit" class="btn" onclick="return confirm('Вы уверены, что хотите удалить всю тренировку?')">❌ Удалить тренировку</button>
        </form>
    </form>
{% endif %}
{% endblock %}
